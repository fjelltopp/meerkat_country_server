version: '2'
services:
  odk:
    environment:
      - "ODK_HOSTNAME=${ODK_HOSTNAME}"
      - "ODK_ADMIN_USERNAME=ops"
      - "DB_USER=odk_mad"
      - "DB_DATABASE=odk_mad"
      - "DB_SCHEMA=odk_mad"
      - "DB_PASSWORD=${DB_PASSWORD}"
      - "DB_HOSTNAME=${DB_HOSTNAME}"
      - "PGPASSWORD=${PGPASSWORD}"
      - "ODK_INSTANCE_ID=${ODK_INSTANCE_ID}"

  nest:
    volumes:
      - "../meerkat_mad/:/var/www/meerkat_mad"
      - "../salt:/var/www/meerkat_mad/nest/salt"
    environment:
      - "CONFIG_OBJECT=config.Production"
      - "MEERKAT_NEST_DB_URL=${MEERKAT_NEST_DB_URL}"
      - "COUNTRY_CONFIG_DIR=/var/www/meerkat_mad/nest/"
      - "COUNTRY_CONFIG=mad_config.py"
  nginx:
    volumes:
      - "/etc/letsencrypt/:/etc/letsencrypt"
    environment:
      - "SSL_CERTIFICATE=/etc/letsencrypt/live/madnest.aws.emro.info/fullchain.pem"
      - "SSL_CERTIFICATE_KEY=/etc/letsencrypt/live/madnest.aws.emro.info/privkey.pem"
